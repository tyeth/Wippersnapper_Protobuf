// SPDX-FileCopyrightText: 2025 Brent Rubell for Adafruit Industries
// SPDX-License-Identifier: MIT
// Display API for Adafruit WipperSnapper

syntax = "proto3";

package wippersnapper.display.v1;
import "nanopb/nanopb.proto";
import "wippersnapper/i2c/v1/i2c.proto";

// ============================================================================
// Enums
// ============================================================================

/**
 * DisplayType determines the type of display
 * and selects which driver should be used.
 */
enum DisplayType {
  DISPLAY_TYPE_UNSPECIFIED = 0; /** Unspecified display type. */
  DISPLAY_TYPE_OLED        = 1; /** OLED display type */
  DISPLAY_TYPE_EPD         = 2; /** EPD display type */
  DISPLAY_TYPE_TFT         = 3; /** TFT display type */
}

/**
 * EPDMode defines the mode of the EPD display.
 * This affects how the display renders images.
 */
enum EPDMode {
  EPD_MODE_UNSPECIFIED = 0; /** Unspecified EPD mode */
  EPD_MODE_GRAYSCALE4  = 1; /** Grayscale 4 EPD mode */
  EPD_MODE_MONO        = 2; /** Monochrome EPD mode */
}

/**
* Desired SSD1306 text 'magnification' size.
*/
enum SSD1306TextSize {
  SSD1306_TEXT_SIZE_UNSPECIFIED = 0; /** Unspecified text size. **/
  SSD1306_TEXT_SIZE_1           = 1; /** Default text size, 6x8px. **/
  SSD1306_TEXT_SIZE_2           = 2; /** Larger text size option, 12x16px. **/
}

/**
* LEDBackpackAlignment represents all text alignment
* options for LED backpack displays
*/
enum LEDBackpackAlignment {
  LED_BACKPACK_ALIGNMENT_UNSPECIFIED = 0; /** Unspecified alignment option. **/
  LED_BACKPACK_ALIGNMENT_LEFT        = 1; /** (Default) Left-aligned. **/
  LED_BACKPACK_ALIGNMENT_RIGHT       = 2; /** Right-aligned. **/
}

// ============================================================================
// Configuration Messages
// ============================================================================

/**
 * SpiConfig contains the configuration for SPI-based displays.
 * Includes the SPI bus number and pin assignments.
 */
message SpiConfig {
  int32 bus          = 1; /** The SPI bus to use */
  string pin_dc      = 2[(nanopb).max_size = 6]; /** Pin for data/command */
  string pin_rst     = 3[(nanopb).max_size = 6]; /** Pin for reset */
  string pin_cs      = 4[(nanopb).max_size = 6]; /** Pin for chip select */
  string pin_sram_cs = 5[(nanopb).max_size = 6]; /** Pin for SRAM chip select */
  string pin_busy    = 6[(nanopb).max_size = 6]; /** Pin for busy signal */
  string pin_mosi    = 7[(nanopb).max_size = 6]; /** Pin for MOSI */
  string pin_sck     = 8[(nanopb).max_size = 6]; /** Pin for SCK */
  string pin_miso    = 9[(nanopb).max_size = 6]; /** Pin for MISO */
}

/**
 * EPDConfig contains the configuration for an EPD display.
 * It includes the mode, dimensions, and panel type.
 */
message EPDConfig {
  EPDMode mode = 1; /** The mode of the EPD display */
}

/**
 * EPDWriteOptions contains options for writing to EPD displays.
 */
message EPDWriteOptions { 
  int32 text_size = 1; /** Scale factor for text (1 = 6x8px, 2 = 12x16px,...) */
}

message TftConfig {
  int32 width  = 1;   /** Width of the TFT display in pixels */
  int32 height = 2;   /** Height of the TFT display in pixels */
  int32 rotation = 3; /** Rotation of the display (0-3) */
}

message I2cConfig {
  wippersnapper.i2c.v1.I2CDeviceInitRequest i2c = 1; /** I2C configuration */
}

/**
* OledConfig represents the configuration for an OLED display.
*/
message OledConfig {
  uint32 width    = 1; /** Width of the display. **/
  uint32 height   = 2; /** Height of the display. **/
  int32 text_size = 3; /** Desired text 'magnification' size. **/
}

/**
* LEDBackpackConfig represents the configuration for a LED backpack display.
*/
message LEDBackpackConfig {
  int32 brightness                = 1; /** Desired brightness of the LED backpack, from 0 (off) to 15 (full brightness). **/
  LEDBackpackAlignment alignment  = 2; /** Desired text alignment for the LED backpack. **/
}

/**
* CharLCDConfig represents the configuration for a character LCD display.
*/
message CharLCDConfig {
  uint32 rows            = 1; /** Number of rows for the character LCD. **/
  uint32 columns         = 2; /** Number of columns for the character LCD. **/
}

// ============================================================================
// Request Messages
// ============================================================================

/**
 * DisplayAddOrReplace adds a new display or replaces an existing one.
 */
message DisplayAddOrReplace {
  DisplayType type = 1; /** The type of display */
  string name = 2[(nanopb).max_size = 64]; /** Identifier for the display */
  oneof interface_type {
    SpiConfig cfg_spi = 3; /** SPI config for EPD */
    I2cConfig cfg_i2c = 4; /** I2C device config */
  }
  oneof config {
    EPDConfig config_epd = 5; /** Config for EPD display */
    TftConfig config_tft = 6; /** Config for TFT display */
    OledConfig config_oled = 7; /** Config for SSD1306 OLED */
    LEDBackpackConfig config_led_backpack = 8; /** Config for LED backpack. */
    CharLCDConfig config_char_lcd = 9; /** Config for character LCD. */
  }
}

/**
 * DisplayRemove removes an existing display.
 */
message DisplayRemove {
  string name = 1[(nanopb).max_size = 64]; /** Identifier for the display. */
}

/**
 * DisplayWrite writes content to a display.
 */
message DisplayWrite {
  string name     = 1[(nanopb).max_size = 64]; /** Identifies the display. */
  string message  = 2[(nanopb).max_size = 1024]; /** Message to write. */
  oneof options {
    EPDWriteOptions epd_options = 3; /** Options for writing to EPD displays */
  }
}

// ============================================================================
// Response Messages
// ============================================================================

/**
 * DisplayAddedorReplaced confirms a display was added or replaced.
 */
message DisplayAddedorReplaced {
  string name  = 1[(nanopb).max_size = 64]; /** Identifier for the display. */
  bool did_add = 2; /** Indicates if a display was added */
}

/**
 * DisplayRemoved confirms a display was removed.
 */
message DisplayRemoved {
  string name     = 1[(nanopb).max_size = 64]; /** Identifies the display. */
  bool did_remove = 2; /** Indicates if a display was removed */
}