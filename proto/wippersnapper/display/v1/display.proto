// SPDX-FileCopyrightText: 2025 Brent Rubell for Adafruit Industries
// SPDX-License-Identifier: MIT
// Display API for Adafruit WipperSnapper

syntax = "proto3";

package wippersnapper.display.v1;
import "nanopb/nanopb.proto";
import "wippersnapper/i2c/v1/i2c.proto";

// ============================================================================
// Enums
// ============================================================================

/**
 * DisplayType determines the type of display
 * and selects which driver should be used.
 */
enum DisplayType {
  DISPLAY_TYPE_UNSPECIFIED = 0; /** Unspecified display type. */
  DISPLAY_TYPE_OLED        = 1; /** OLED display type */
  DISPLAY_TYPE_EPD         = 2; /** EPD display type */
  DISPLAY_TYPE_TFT         = 3; /** TFT display type */
}

/**
 * EPDMode defines the mode of the EPD display.
 * This affects how the display renders images.
 */
enum EPDMode {
  EPD_MODE_UNSPECIFIED = 0; /** Unspecified EPD mode */
  EPD_MODE_GRAYSCALE4  = 1; /** Grayscale 4 EPD mode */
  EPD_MODE_MONO        = 2; /** Monochrome EPD mode */
}

// ============================================================================
// Configuration Messages
// ============================================================================

/**
 * EpdSpiConfig contains the configuration for SPI-based EPD displays.
 * Includes the SPI bus number and pin assignments.
 */
message EpdSpiConfig {
  int32 bus          = 1; /** The SPI bus to use */
  string pin_dc      = 2[(nanopb).max_size = 6]; /** Pin for data/command */
  string pin_rst     = 3[(nanopb).max_size = 6]; /** Pin for reset */
  string pin_cs      = 4[(nanopb).max_size = 6]; /** Pin for chip select */
  string pin_sram_cs = 5[(nanopb).max_size = 6]; /** Pin for SRAM chip select */
  string pin_busy    = 6[(nanopb).max_size = 6]; /** Pin for busy signal */
}

/**
 * EPDConfig contains the configuration for an EPD display.
 * It includes the mode, dimensions, and panel type.
 */
message EPDConfig {
  EPDMode mode = 1; /** The mode of the EPD display */
}

/**
 * EPDWriteOptions contains options for writing to EPD displays.
 */
message EPDWriteOptions { 
  int32 text_size = 1; /** Scale factor for text (1 = 6x8px, 2 = 12x16px,...) */
}

/**
 * TftSpiConfig contains the configuration for SPI TFT displays.
 * Includes the SPI bus number and pin assignments.
 */
message TftSpiConfig {
  int32 bus          = 1; /** The SPI bus to use */
  string pin_cs      = 2[(nanopb).max_size = 6]; /** Pin for chip select */
  string pin_dc      = 3[(nanopb).max_size = 6]; /** Pin for data/command */
  string pin_mosi    = 4[(nanopb).max_size = 6]; /** Pin for MOSI */
  string pin_sck     = 5[(nanopb).max_size = 6]; /** Pin for SCK */
  string pin_rst     = 6[(nanopb).max_size = 6]; /** Pin for reset */
  string pin_miso    = 7[(nanopb).max_size = 6]; /** Pin for MISO */
}

message TftConfig {
  int32 width  = 1;   /** Width of the TFT display in pixels */
  int32 height = 2;   /** Height of the TFT display in pixels */
  int32 rotation = 3; /** Rotation of the display (0-3) */
}

// ============================================================================
// Request Messages
// ============================================================================

/**
 * DisplayAddOrReplace adds a new display or replaces an existing one.
 */
message DisplayAddOrReplace {
  DisplayType type = 1; /** The type of display */
  string name = 2[(nanopb).max_size = 64]; /** Identifier for the display */
  oneof interface_type {
    EpdSpiConfig spi_epd = 3; /** SPI configuration for EPD */
    TftSpiConfig spi_tft = 4; /** SPI configuration for TFT */
  }
  oneof config {
    EPDConfig config_epd = 5; /** Configuration for EPD display */
    TftConfig config_tft = 6; /** Configuration for TFT display */
  }
}

/**
 * DisplayRemove removes an existing display.
 */
message DisplayRemove {
  string name = 1[(nanopb).max_size = 64]; /** Identifier for the display. */
}

/**
 * DisplayWrite writes content to a display.
 */
message DisplayWrite {
  string name     = 1[(nanopb).max_size = 64]; /** Identifies the display. */
  string message  = 2[(nanopb).max_size = 1024]; /** Message to write. */
  oneof options {
    EPDWriteOptions epd_options = 3; /** Options for writing to EPD displays */
  }
}

// ============================================================================
// Response Messages
// ============================================================================

/**
 * DisplayAddedorReplaced confirms a display was added or replaced.
 */
message DisplayAddedorReplaced {
  string name  = 1[(nanopb).max_size = 64]; /** Identifier for the display. */
  bool did_add = 2; /** Indicates if a display was added */
}

/**
 * DisplayRemoved confirms a display was removed.
 */
message DisplayRemoved {
  string name     = 1[(nanopb).max_size = 64]; /** Identifies the display. */
  bool did_remove = 2; /** Indicates if a display was removed */
}